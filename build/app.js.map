{"version":3,"sources":["../src/app.js"],"names":["router","bluebird","promisifyAll","redis","RedisClient","prototype","Multi","app","LoggerMiddleware","req","res","next","random","Math","floor","originalUrl","indexOf","errorMessage","logger","error","method","ip","status","err","use","REDIS_URL","process","env","client","createClient","set","__dirname","debug","stream","winston","write","bodyParser","urlencoded","extended","json","express","static","indexRouter","productsRouter","locals","message","get","render"],"mappings":"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","sourcesContent":["import express, { Router, urlencoded } from 'express';\nimport bodyParser from 'body-parser';\nimport cors from 'cors';\nimport helmet from 'helmet';\nimport { config } from 'dotenv';\nimport redis from 'redis';\nimport bluebird from 'bluebird';\nimport logger from './utils/logger';\nimport winston from 'winston';\n\nconfig();\n\nconst router = Router();\nimport { firebase } from './authentication/firebase';\nimport { join } from 'path';\nimport cookieParser from 'cookie-parser';\nimport morgan from 'morgan';\n\nimport indexRouter from './routes/index';\nimport productsRouter from './routes/products';\n\n\nbluebird.promisifyAll(redis.RedisClient.prototype);\nbluebird.promisifyAll(redis.Multi.prototype);\n\nconst app = express();\n\nconst LoggerMiddleware = (req,res,next) => {\n\n  const random = Math.floor(Math.random() * 100) + 1;\n  const { originalUrl } = req;\n  if (random < 15 && (originalUrl.indexOf('login') === -1)) {\n    let errorMessage = `Error Code: 500\\nMessage: error simulado`;\n    logger.error(`500 - ${errorMessage} - ${req.originalUrl} - ${req.method} - ${req.ip}`);\n    res.status(err.status || 500);\n  }\n\n  next();\n};\n\napp.use(LoggerMiddleware);\n\nconst REDIS_URL = process.env.REDIS_URL;\nexport const client = redis.createClient(REDIS_URL)\n\n// view engine setup\napp.set('views', join(__dirname, '../src/views'));\napp.set('view engine', 'pug');\n\napp.use(cors());\napp.use(helmet());\n\nlogger.debug(\"Overriding 'Express' logger\");\napp.use(morgan('combined', { stream: winston.stream.write }));\n\napp.use(bodyParser.urlencoded({ extended: false }));\napp.use(bodyParser.json());\napp.use(urlencoded({ extended: false }));\napp.use(cookieParser());\napp.use(express.static(join(__dirname, 'public')));\n\nrouter.use('/', indexRouter);\nrouter.use('/products', productsRouter);\n\napp.use('/api', router);\n\n// error handler\napp.use(function (err, req, res, next) {\n  res.locals.message = err.message;\n  res.locals.error = req.app.get('env') === 'development' ? err : {};\n  // Escribimos el error\n  logger.error(`${err.status || 500} - ${err.message} - ${req.originalUrl} - ${req.method} - ${req.ip}`);\n\n  res.status(err.status || 500);\n  res.render('error');\n  });\n\nexport default app;\n"],"file":"app.js"}